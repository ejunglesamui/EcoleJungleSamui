//Export de la liste des élèves	function exportEleves(request, response) {	response.contentType = 'application/vnd.ms-excel';	//response.contentType = 'text/plain';	var vToday, exportData, dNais, dtNais, vSect, vCar, vAnScol, AnScol, vLibAn, vMail, Nday, Nmonth, Nyear, vCoul;	vToday = new Date();	vCoul = "#FFFFFF";	AnScol = ds.Annees_Scolaires.query("Date_Debut <= :1 and Date_fin >= :1", vToday);	vAnScol = AnScol[0].ID;	vLibAn = AnScol[0].Annee_Scolaire;	if (vAnScol !== null) {		exportData = '<head> <meta charset="UTF-8"> </head> ';		exportData += '<TABLE cellspacing="2px" cellpadding="2px" cellspacing="1px" rules="all" style="border:solid 2px black; font-family:Calibri; font-size:12px; vertical-align: middle;">';		exportData += "<TR><TD COLSPAN=7 height=50 align=CENTER><B><font size=5 >Liste des élèves inscrits à JungleSamui pour l'année scolaire "+vLibAn+"</B><BR>"		exportData += "<font size=3 >Export eJungle ( "+vToday+" )</TD></TR>";		eleves = ds.Parcours_Scolaire.query("Annee_Scolaire.ID = :1 order by Eleve.Nom_Complet", vAnScol);		exportData += '<TR><TD align=CENTER height=20 width=220 bgcolor="#0B0B61"><B><FONT color=#FFFFFF>Nom Prénom</B></TD><TD align=CENTER width=100 bgcolor="#084B8A">';		exportData += '<B><FONT color=#FFFFFF>Classe</B></TD><TD align=CENTER width=90 bgcolor="#0B0B61"><FONT color=#FFFFFF><B>Filière</B></TD>';		exportData += '<TD align=CENTER width=90 bgcolor="#084B8A"><B><FONT color=#FFFFFF>Section</B></TD><TD align=CENTER width=90 bgcolor="#0B0B61"><B><FONT color=#FFFFFF>Sexe</B></TD>';		exportData += '<TD align=CENTER width=90 bgcolor="#084B8A"><B><FONT color=#FFFFFF>Né(e) le</B></TD><TD align=CENTER width=300 bgcolor="#0B0B61"><B><FONT color=#FFFFFF>eMail</B></TD></TR>';		eleves.forEach(function (eleve) {			dNais = eleve.Eleve.Date_Naissance;			vCar = eleve.Classe.substring(0,1);			if (vCar === "C" || vCar === "M") {				vSect = "Primaire";			} else {				vSect = "Secondaire";			}			if  (dNais === null) {				dtNais = " ";			} else {				Nday = dNais.getDate();				Nday = ((Nday < 10) ? '0' : '') + Nday; 				Nmonth = dNais.getMonth() + 1;				Nmonth = ((Nmonth < 10) ? '0' : '') + Nmonth; 				Nyear = dNais.getYear();				Nyear = ((Nyear < 200) ? 1900 : 0) + Nyear; 				dtNais = Nday + '/' + Nmonth + '/' + Nyear;			}			vMail = eleve.Eleve.Utilisateur.eMail;			if (vMail === null) {				vMail = " ";			}			if (vCoul === "#CEECF5") {				vCoul = "#FFFFFF";			} else {				vCoul = "#CEECF5";			}			exportData +=  '<TR><TD bgcolor="'+vCoul+'">' + eleve.Eleve.Nom_Complet + '</TD><TD bgcolor="'+vCoul+'">' + eleve.Classe + '</TD><TD bgcolor="'+vCoul+'">' + eleve.Filiere + '</TD>';			exportData +=  '<TD bgcolor="'+vCoul+'">' + vSect + '</TD><TD bgcolor="'+vCoul+'" align=CENTER>' + eleve.Eleve.Sexe + '</TD><TD bgcolor="'+vCoul+'"> ( ' + dtNais + ' ) </TD><TD bgcolor="'+vCoul+'">' + vMail + '</TD></TR>';		});		exportData += '</TABLE>';	} else {		exportData = " ";	}	return exportData;}function ListEleves(request, response) {			var vHtml, vToday, exportData, dNais, dtNais, vSect, vCar, vAnScol, AnScol, vLibAn, vMail, Nday, Nmonth, Nyear, vCoul, vSexe, vAn, eleves, dDeb, dFin, vFam, vMoi, freres, vNbf, vLien, vNe, vDne, vUser, uParam, vUserName, vParaA;		vUser = currentUser();    vUserName = vUser.name;	uParam = ds.UserParam.query("Utilisateur.Login = :1", vUserName);	if (uParam[0].Preview) {		response.contentType = 'text/html';	} else {		response.contentType = 'application/vnd.ms-excel';	}		vToday = new Date();	vParaA = uParam[0].Annee_Scolaire;	AnScol = ds.Annees_Scolaires.query("ID = :1", vParaA);	vAnScol = AnScol[0].ID;	vLibAn = AnScol[0].Annee_Scolaire;	if (vAnScol !== null) {		vHtml = '<head> <meta charset="UTF-8"> </head> ';		vHtml += '<style> .break { page-break-after: always; } </style>';		eleves = ds.Parcours_Scolaire.query("Annee_Scolaire.ID = :1 order by Eleve.Nom_Complet", vAnScol);		eleves.forEach(function (eleve) {			dNais = eleve.Eleve.Date_Naissance;			vFam = eleve.Eleve.MaFamille.ID;			vMoi = eleve.Eleve.Nom_Complet;			dDeb = eleve.Date_Deb;			dFin = eleve.Dat_Fin;			if (dNais !== null) {				Nday = dNais.getDate();				Nday = ((Nday < 10) ? '0' : '') + Nday; 				Nmonth = dNais.getMonth() + 1;				Nmonth = ((Nmonth < 10) ? '0' : '') + Nmonth; 				Nyear = dNais.getYear();				Nyear = ((Nyear < 200) ? 1900 : 0) + Nyear; 				dNais =  Nday + '/' + Nmonth + '/' + Nyear;			} else {				dNais = " ";			}			if (dDeb !== null) {				Nday = dDeb.getDate();				Nday = ((Nday < 10) ? '0' : '') + Nday; 				Nmonth = dDeb.getMonth() + 1;				Nmonth = ((Nmonth < 10) ? '0' : '') + Nmonth; 				Nyear = dDeb.getYear();				Nyear = ((Nyear < 200) ? 1900 : 0) + Nyear; 				dDeb =  Nday + '/' + Nmonth + '/' + Nyear;			} else {				dDeb = " ";			}			if (dFin !== null) {				Nday = dFin.getDate();				Nday = ((Nday < 10) ? '0' : '') + Nday; 				Nmonth = dFin.getMonth() + 1;				Nmonth = ((Nmonth < 10) ? '0' : '') + Nmonth; 				Nyear = dFin.getYear();				Nyear = ((Nyear < 200) ? 1900 : 0) + Nyear; 				dFin =  Nday + '/' + Nmonth + '/' + Nyear;			} else {				dFin = " ";			}			vCar = eleve.Classe.substring(0,1);			vSexe = "Féminin";			if (eleve.Eleve.Sexe === "M") {				vSexe = "Masculin";			}			if (eleve.Annee_Complete) {				vAn = "Complète";			} else {				vAn = "Partielle";			}			vHtml += '<TABLE cellpadding="2px" cellspacing="2px" width=800 rules="all" style="border:solid 2px black; font-family:Calibri; font-size:12px; vertical-align: middle;">';			vHtml += "<TR><TD width=10% align=center> Logo </TD><TD width=20%>Ecole Française de Koh Samui<BR>143/1 Moo 4, Maret Lamai<BR>Koh Samui, 84310 Surathani<BR>Téléphone : 08 24 14 24 29</TD>";			vHtml += "<TD width=70% align=center><FONT SIZE=5><B>&nbsp;FICHE INDIVIDUELLE D'INFORMATION&nbsp;</B></TD></TR></TABLE><TABLE border=0><TR><TD height=15>&nbsp;</TD></TR></TABLE>";			vHtml += '<TABLE cellpadding="2px" cellspacing="3px" width=800 style="border:solid 1px black; font-family:Calibri; font-size:12px; vertical-align: middle;">';			vHtml += '<TR><TD COLSPAN=7></TD></TR>';			vHtml += '<TR><TD></TD><TD COLSPAN=3><B>'+vLibAn+'</B></TD><TD COLSPAN=2 height=30 valign=middle><I><B>Informations sur le Père</TD><TD></TD></TR>';			vHtml += '<TR><TD width=2%></TD><TD width=10% align=right bgcolor=#A9D0F5><B>Nom&nbsp;</TD><TD width=33%>'+eleve.Eleve.Utilisateur.Nom+'</TD><TD width=6%></TD><TD width=10% align=right bgcolor=#A9D0F5><B>Nom&nbsp;</B></TD><TD width=35%>'+((eleve.Eleve.MaFamille.Pere_Nom === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Nom)+'</TD><TD width=2%></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Prénom&nbsp;</TD><TD>'+eleve.Eleve.Utilisateur.Prenom+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Prénom&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Prenom === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Prenom)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Sexe&nbsp;</TD><TD>'+vSexe+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Profession&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Profession === null) ?  ' ' : eleve.Eleve.MaFamille.Pere_Profession)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Né(e) le&nbsp;</TD><TD>'+ dNais+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Téléphone&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Telephone === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Telephone)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>eMail&nbsp;</TD><TD>'+((eleve.Eleve.Utilisateur.eMail === null) ? ' ' : eleve.Eleve.Utilisateur.eMail)+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Adresse 1&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Adresse_1 === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Adresse_1)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD COLSPAN=4 ROWSPAN=2></TD><TD align=right bgcolor=#A9D0F5><B>Adresse 2&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Adresse_2 === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Adresse_2)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD align=right bgcolor=#A9D0F5><B>CP / Ville&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_Adresse_CP === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Adresse_CP)+' '+((eleve.Eleve.MaFamille.Pere_Adresse_Ville === null) ? ' ' : eleve.Eleve.MaFamille.Pere_Adresse_Ville)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Classe&nbsp;</TD><TD>' + eleve.Classe + '</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>eMail&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Pere_eMail === null) ? ' ' : eleve.Eleve.MaFamille.Pere_eMail)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Filière&nbsp;</TD><TD>' + eleve.Filiere + '</TD><TD></TD><TD COLSPAN=3>&nbsp;</TD></TR>';			vHtml += '<TR><TD COLSPAN=4></TD><TD COLSPAN=2 height=30 valign=middle><I><B>Informations sur la Mère</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Année&nbsp;</TD><TD>'+vAn+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Nom&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Nom === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Nom)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Période&nbsp;</TD><TD>du '+ dDeb +' au '+ dFin +'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Prénom&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Prenom === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Prenom)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>Assurance&nbsp;</TD><TD>'+((eleve.Assurance_Nom === null) ? ' ' : eleve.Assurance_Nom)+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Profession&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Profession === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Profession)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>n°&nbsp;</TD><TD>'+((eleve.Assurance_Numero === null) ? ' ' : eleve.Assurance_Numero)+'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>Téléphone&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Telephone === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Telephone)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD COLSPAN=4></TD><TD align=right bgcolor=#A9D0F5><B>Adresse 1&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Adresse_1 === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_1)+'</TD><TD></TD></TR>';			vHtml += '<TR><TD></TD><TD COLSPAN=3><B>Frères et soeurs scolarisés</B></TD><TD align=right bgcolor=#A9D0F5><B>Adresse 2&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Adresse_2 === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_2)+'</TD><TD></TD></TR>';						freres = ds.Eleves.query("MaFamille.ID = :1 and Nom_Complet != :2 order by Nom_Complet", vFam, vMoi);			if (freres.length === 0) {				vHtml += '<TR><TD COLSPAN=4></TD><TD align=right bgcolor=#A9D0F5><B>CP / Ville&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Adresse_CP === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_CP)+' '+((eleve.Eleve.MaFamille.Mere_Adresse_Ville === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_Ville)+'</TD><TD></TD></TR>';			} else {				vNbf = 1;				freres.forEach(function (frere) {					vDne = frere.Date_Naissance;					if (vDne !== null) {						Nday = vDne.getDate();						Nday = ((Nday < 10) ? '0' : '') + Nday; 						Nmonth = vDne.getMonth() + 1;						Nmonth = ((Nmonth < 10) ? '0' : '') + Nmonth; 						Nyear = vDne.getYear();						Nyear = ((Nyear < 200) ? 1900 : 0) + Nyear; 						vDne =  Nday + '/' + Nmonth + '/' + Nyear;					} else {						vDne = " ";					}					if (vNbf === 1) {						vLien = "Frère";						vNe = "né le ";						if (frere.Sexe === "F") {							vLien = "Soeur";							vNe = "née le ";						}						vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>'+vLien+'&nbsp;</TD><TD>' + frere.Nom_Complet + ' ' + vNe + ' ' +  vDne +'</TD><TD></TD><TD align=right bgcolor=#A9D0F5><B>CP / Ville&nbsp;</B></TD><TD>'+((eleve.Eleve.MaFamille.Mere_Adresse_CP === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_CP)+' '+((eleve.Eleve.MaFamille.Mere_Adresse_Ville === null) ? ' ' : eleve.Eleve.MaFamille.Mere_Adresse_Ville)+'</TD><TD></TD></TR>';						vNbf += 1;					} else {						vHtml += '<TR><TD></TD><TD align=right bgcolor=#A9D0F5><B>'+vLien+'&nbsp;</TD><TD>' + frere.Nom_Complet + ' ' + vNe + ' ' +  vDne +'</TD><TD COLSPAN=4></TD></TR>';					}				});			}			vHtml += '<TR><TD COLSPAN=7></TD></TR></TABLE>';			vHtml += '<P class="break">';			vHtml += '<TABLE width=800 border=0><TR><TD height=5 bgcolor=#FFFFFF>&nbsp;</TD></TR></TABLE><P>';		});	}		return vHtml;		}function SuiviEleves(request, response) {			var vHtml, vToday, exportData, dNais, dtNais, vSect, vCar, vAnScol, AnScol, vLibAn, vMail, Nday, Nmonth, Nyear, vCoul, vSexe, vAn, eleves, dDeb, dFin, vFam, vMoi, freres, vNbf, vLien, vNe, vDne, vUser, uParam, vUserName, vParaA;		vUser = currentUser();    vUserName = vUser.name;	uParam = ds.UserParam.query("Utilisateur.Login = :1", vUserName);	if (uParam[0].Preview) {		response.contentType = 'text/html';	} else {		response.contentType = 'application/vnd.ms-excel';	}		vToday = new Date();	vParaA = uParam[0].Annee_Scolaire;	vParaM = uParam[0].Mois;	AnScol = ds.Annees_Scolaires.query("ID = :1", vParaA);	vAnScol = AnScol[0].ID;	vLibAn = AnScol[0].Annee_Scolaire;	if (vAnScol !== null) {		vHtml = '<head> <meta charset="UTF-8"> </head> ';		vHtml += '<style> .break { page-break-after: always; } </style>';		eleves = ds.Parcours_Scolaire.query("Annee_Scolaire.ID = :1 order by Eleve.Nom_Complet", vAnScol);		eleves.forEach(function (eleve) {			vHtml += '<TABLE cellpadding="2px" cellspacing="2px" width=800 rules="all" style="border:solid 2px black; font-family:Calibri; font-size:12px; vertical-align: middle;">';			vHtml += "<TR><TD width=10% align=center> Logo </TD><TD width=20%>Ecole Française de Koh Samui<BR>143/1 Moo 4, Maret Lamai<BR>Koh Samui, 84310 Surathani<BR>Téléphone : 08 24 14 24 29</TD>";			vHtml += "<TD width=70% align=center><FONT SIZE=5><B>&nbsp;FICHE DE SUIVI MENSUEL&nbsp;</B></TD></TR></TABLE><TABLE border=0><TR><TD height=15>&nbsp;</TD></TR></TABLE>";			vHtml += '<TABLE cellpadding="2px" cellspacing="3px" width=800 style="border:solid 1px black; font-family:Calibri; font-size:12px; vertical-align: middle;">';			vHtml += '<TR><TD COLSPAN=7></TD></TR>';		});	}		return vHtml;		}